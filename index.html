<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>سوق أبوالوفا – متجر الكتب</title>
  <meta name="description" content="متجر كتب عربي بتصميم احترافي: تصفح، تفاصيل، تعليقات، سلة، ودفع بفودافون كاش." />
  <style>
    :root{
      --brand:#008ecc;          /* أزرق أساسي */
      --brand-2:#0672a8;        /* درجة أدكن */
      --accent:#ffb703;         /* أصفر دافئ */
      --bg:#f6f7fb;             /* خلفية فاتحة */
      --card:#ffffff;           /* بطاقات */
      --text:#1f2937;           /* نص أساسي */
      --muted:#6b7280;          /* نص ثانوي */
      --shadow:0 8px 24px rgba(0,0,0,.08);
      --radius:16px;
      --nav-h:66px;
      --maxw:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Cairo","Tahoma",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.65;
    }
    /* ====== رأس الصفحة ====== */
    header{
      position:sticky; top:0; z-index:30;
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      color:#fff;
      box-shadow:var(--shadow);
    }
    .topbar{
      max-width:var(--maxw);
      margin:0 auto;
      padding:14px 16px;
      display:flex; align-items:center; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px;
      font-size:20px;
    }
    .brand .dot{width:10px; height:10px; border-radius:50%; background:var(--accent)}
    .search{
      margin-inline-start:auto;
      display:flex; align-items:center; gap:8px;
      background:rgba(255,255,255,.14);
      padding:8px 12px; border-radius:999px; min-width:200px; width:min(520px,58vw);
    }
    .search input{
      background:transparent; border:0; outline:0; color:#fff; width:100%; font-size:14px;
    }
    .search input::placeholder{color:rgba(255,255,255,.8)}
    /* ====== الوعاء الرئيسي ====== */
    main{max-width:var(--maxw); margin:0 auto; padding:18px 16px calc(var(--nav-h) + 20px)}
    .page{display:none}
    .page.active{display:block}
    /* ====== شبكة الكتب ====== */
    .grid{
      display:grid; gap:16px;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
    }
    .card{
      background:var(--card); border-radius:var(--radius); overflow:hidden;
      box-shadow:var(--shadow); transition:transform .18s ease, box-shadow .18s ease;
      cursor:pointer; display:flex; flex-direction:column;
    }
    .card:hover{transform:translateY(-4px); box-shadow:0 12px 28px rgba(0,0,0,.12)}
    .thumb{aspect-ratio:3/4; width:100%; object-fit:cover}
    .meta{padding:10px 12px 14px}
    .title{margin:0 0 6px; font-size:15px; font-weight:800}
    .price{font-size:14px; color:var(--brand-2); font-weight:800}
    /* ====== تفاصيل الكتاب ====== */
    .details{
      display:grid; grid-template-columns:320px 1fr; gap:24px;
      align-items:start;
    }
    .details img{width:100%; border-radius:var(--radius); box-shadow:var(--shadow); object-fit:cover}
    .badge{display:inline-block; background:#eef2ff; color:#1e3a8a; padding:4px 10px; border-radius:999px; font-size:12px; margin-inline-start:6px}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .btn{
      border:0; outline:0; border-radius:12px; padding:10px 14px; cursor:pointer;
      font-weight:800; transition:.18s ease; box-shadow:var(--shadow); font-size:14px;
    }
    .btn.brand{background:var(--brand); color:#fff}
    .btn.brand:hover{background:var(--brand-2)}
    .btn.ghost{background:#fff}
    .muted{color:var(--muted); font-size:14px}
    .divider{height:1px; background:#e5e7eb; margin:16px 0}
    .reviews .item{background:#fff; border-radius:12px; padding:12px 14px; box-shadow:var(--shadow); margin-bottom:10px}
    .add-comment{display:flex; gap:8px}
    .add-comment input{flex:1; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; font-size:14px}
    /* ====== السلة ====== */
    .cart-row{
      display:grid; grid-template-columns:68px 1fr auto auto; gap:12px; align-items:center;
      background:#fff; border-radius:14px; padding:10px 12px; box-shadow:var(--shadow); margin-bottom:10px
    }
    .cthumb{width:68px; height:92px; border-radius:10px; object-fit:cover}
    .qty{display:flex; align-items:center; gap:8px}
    .qty button{width:28px; height:28px; border-radius:8px; border:0; background:#eef2f7; cursor:pointer; font-weight:900}
    .totals{display:flex; justify-content:space-between; align-items:center; background:#fff; border-radius:16px; padding:14px 16px; box-shadow:var(--shadow); margin-top:12px; font-weight:900}
    /* ====== لوحات عامة ====== */
    .panel{background:#fff; border-radius:16px; padding:16px; box-shadow:var(--shadow)}
    .panel input{width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:12px; font-size:14px}
    /* ====== شريط سفلي ثابت ====== */
    .bottom-nav{
      position:fixed; bottom:0; left:0; right:0; height:var(--nav-h); z-index:40;
      background:#fff; border-top:1px solid #e5e7eb; display:flex; justify-content:space-around; align-items:center;
      box-shadow:0 -8px 18px rgba(0,0,0,.06)
    }
    .nav-item{display:flex; flex-direction:column; align-items:center; gap:4px; color:#111; text-decoration:none; font-size:12px}
    .nav-item.active{color:var(--brand)}
    .pill{display:inline-flex; min-width:20px; height:20px; border-radius:999px; background:var(--accent); color:#111; font-weight:900; align-items:center; justify-content:center; font-size:12px; padding:0 6px}
    /* ====== Responsiveness ====== */
    @media (max-width:1024px){ .details{grid-template-columns:260px 1fr} }
    @media (max-width:860px){ .details{grid-template-columns:1fr} }
    @media (max-width:520px){
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
      .topbar{padding:12px}
      .brand{font-size:18px}
      .search{width:100%}
    }
    @media (max-width:360px){
      .grid{grid-template-columns:1fr} /* كتاب واحد في الصف للأجهزة الصغيرة جدًا */
    }
  </style>
</head>
<body>

  <!-- ====== Header ====== -->
  <header>
    <div class="topbar">
      <div class="brand">📚 سوق أبوالوفا <span class="dot"></span></div>
      <label class="search">🔎
        <input id="q" type="search" placeholder="ابحث عن كتاب..." oninput="filterBooks(this.value)">
      </label>
    </div>
  </header>

  <!-- ====== Main ====== -->
  <main>
    <!-- صفحة الكتب -->
    <section id="page-books" class="page active">
      <div id="booksGrid" class="grid"></div>
    </section>

    <!-- صفحة التفاصيل -->
    <section id="page-details" class="page">
      <div class="details">
        <img id="dImg" alt="غلاف الكتاب">
        <div>
          <h2 id="dTitle" style="margin:.2rem 0 .4rem; font-size:26px; font-weight:900"></h2>
          <div class="muted">السعر: <b id="dPrice"></b> جنيه <span id="dBadge" class="badge">كتاب مميز</span></div>
          <div class="actions">
            <button class="btn brand" onclick="addCurrentToCart()">إضافة للسلة 🛒</button>
            <button class="btn ghost" onclick="goBack()">رجوع للقائمة</button>
          </div>
          <div class="divider"></div>
          <p id="dDesc" style="font-size:15px"></p>

          <div class="divider"></div>
          <div class="reviews">
            <h3 style="margin:0 0 8px">💬 التعليقات</h3>
            <div id="reviewsList"></div>
            <div class="add-comment" style="margin-top:10px">
              <input id="commentInput" type="text" placeholder="اكتب تعليقك واضغط إضافة...">
              <button class="btn brand" onclick="addComment()">إضافة</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- صفحة السلة -->
    <section id="page-cart" class="page">
      <h2 style="margin:0 0 10px">🛒 سلة المشتريات</h2>
      <div id="cartList"></div>
      <div class="totals">
        <div>الإجمالي: <span id="cartTotal">0</span> جنيه</div>
        <div class="qty">
          <button class="btn ghost" onclick="clearCart()">تفريغ السلة</button>
          <button class="btn brand" onclick="showPage('payment')">المتابعة للدفع</button>
        </div>
      </div>
    </section>

    <!-- صفحة الحساب -->
    <section id="page-account" class="page">
      <div class="panel">
        <h2 style="margin-top:0">👤 الحساب</h2>
        <div id="authBox">
          <p class="muted">سجّل اسمك للمتابعة (نموذج محلي للتجربة)</p>
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <input id="nameInput" placeholder="اكتب اسمك...">
            <button class="btn brand" onclick="fakeLogin()">تسجيل</button>
          </div>
        </div>
        <div id="welcomeBox" class="panel hide" style="margin-top:10px">
          <p style="margin:0">مرحبًا، <b id="welcomeName"></b> 🎉</p>
          <div class="actions" style="margin-top:8px">
            <button class="btn ghost" onclick="logout()">تسجيل الخروج</button>
          </div>
        </div>
      </div>
    </section>

    <!-- صفحة الدفع -->
    <section id="page-payment" class="page">
      <div class="panel">
        <h2 style="margin-top:0">💳 الدفع</h2>
        <p>من فضلك قم بتحويل المبلغ عبر <b>فودافون كاش</b> إلى الرقم:</p>
        <p style="font-size:22px; font-weight:900; color:#d00000; margin:.4rem 0">01553073695</p>
        <p class="muted">بعد التحويل، احتفظ برقم العملية وتواصل معنا لتأكيد الطلب.</p>
        <div class="divider"></div>
        <div><b>ملخص الطلب:</b></div>
        <div id="paySummary" class="muted" style="margin-top:6px"></div>
        <div class="actions" style="margin-top:10px">
          <button class="btn brand" onclick="confirmOrder()">تأكيد الدفع</button>
          <button class="btn ghost" onclick="showPage('cart')">رجوع للسلة</button>
        </div>
      </div>
    </section>
  </main>

  <!-- ====== Bottom Nav ====== -->
  <nav class="bottom-nav">
    <a id="nav-books" class="nav-item active" href="#" onclick="showPage('books')">🏠 <span>الرئيسية</span></a>
    <a id="nav-cart" class="nav-item" href="#" onclick="showPage('cart')">🛒 <span>السلة <span id="cartCount" class="pill">0</span></span></a>
    <a id="nav-account" class="nav-item" href="#" onclick="showPage('account')">👤 <span>الحساب</span></a>
    <a id="nav-payment" class="nav-item" href="#" onclick="showPage('payment')">💳 <span>الدفع</span></a>
  </nav>

  <!-- ====== JavaScript ====== -->
  <script>
    /* ====== توليد 100 كتاب بدون أرقام في العناوين ====== */
    const nouns = ['الحكمة','القراءة','الإلهام','النجاح','الفشل','الصبر','الشجاعة','الهدوء','القيادة','التفاوض','الإبداع','الخيال','الطموح','العادات','التفكير','المعرفة','العلم','العمل','المستقبل','التكنولوجيا','اللغة','التاريخ','الفلسفة','الأدب','الرحلة','الطبيعة','الاقتصاد','المال','الإدارة','التسويق','البرمجة','التصميم','الموسيقى','التصوير','الشعر','الطبخ','الصحة','اللياقة','التربية','النفس','العلاقات','الوقت','المهارات','التواصل','الإقناع','التوازن','المرونة','القيم','الابتكار','التركيز','الإنتاجية','الوعي','العقل','التأثير','الريادة','الانضباط','الطاقة','الذهن','الخيارات','اتخاذ القرار','التعلّم','الذاكرة','الملاحظة','التحليل','الحياة','العمل الحر','الفن','السينما','السرد','القصة','الدراما','الرحلات','الطهي','البستنة','الطاقة الشمسية','البيانات','الذكاء الاصطناعي','الأمن الرقمي','الألعاب','الاستثمار','الأسواق','المحاسبة','المشاريع','القانون','الدبلوماسية','الأطفال','المدرسة','الجامعة','المنطق','الأخلاق','الكون','الفضاء','الطيران','المحيطات','البيئة','الزراعة','الترجمة','التدوين','الخط العربي','التغذية'];
    const adjectives = ['المبسّط','العملي','المتقدم','للمبتدئين','الشامل','المكثّف','المرشد','الحديث','الفعّال','المنهجي','الإستراتيجي','اليومي','السريع','الإبداعي','المتوازن','العميق','الذهبي','الرقمي','المعاصر','المُلهم'];
    const starters = ['فن','قوة','أسرار','دليل','مدخل إلى','رحلة إلى','خارطة طريق','أساسيات','مختصر','خطوة خطوة إلى'];

    function slugify(s){return s.toLowerCase().replace(/\s+/g,'-').replace(/[^\u0600-\u06FFa-z0-9\-]/g,'')}
    function generateBooks(count=100){
      const set = new Set(), arr=[];
      let i=0, guard=0;
      while(arr.length<count && guard<6000){
        guard++;
        const form = i%5;
        const n = nouns[i % nouns.length];
        const a = adjectives[(i*3) % adjectives.length];
        const st = starters[(i*7) % starters.length];
        let title='';
        if(form===0) title = `${st} ${n}`;
        if(form===1) title = `${n} ${a}`;
        if(form===2) title = `${st} ${n} ${a}`;
        if(form===3) title = `طريق ${n}`;
        if(form===4) title = `لغة ${n}`;
        title = title.replace(/\s+/g,' ').trim();
        if(!set.has(title)){
          set.add(title);
          const slug = slugify(title);
          const price = 80 + ((i*7) % 101); // 80..180
          arr.push({
            id:slug + '_' + (i+1),
            title,
            price,
            image:`https://picsum.photos/seed/${encodeURIComponent(slug)}/400/560`,
            desc:`«${title}» يقدم أفكارًا عملية وقصصًا موجزة تساعدك على الفهم والتطبيق في حياتك اليومية. مناسب للقرّاء الذين يبحثون عن محتوى واضح ومباشر مع أمثلة واقعية.`,
          });
        }
        i++;
      }
      return arr;
    }
    const BOOKS = generateBooks(100);

    /* ====== تخزين محلي بسيط ====== */
    const LS = {
      get(k,def){try{return JSON.parse(localStorage.getItem(k)) ?? def}catch{return def}},
      set(k,v){localStorage.setItem(k,JSON.stringify(v))}
    };

    /* ====== عناصر DOM ====== */
    const booksGrid = document.getElementById('booksGrid');
    const qInput = document.getElementById('q');

    const dImg = document.getElementById('dImg');
    const dTitle = document.getElementById('dTitle');
    const dPrice = document.getElementById('dPrice');
    const dDesc = document.getElementById('dDesc');
    const dBadge = document.getElementById('dBadge');
    const reviewsList = document.getElementById('reviewsList');
    const commentInput = document.getElementById('commentInput');

    const cartList = document.getElementById('cartList');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartCount = document.getElementById('cartCount');
    const paySummary = document.getElementById('paySummary');

    /* ====== صفحات ====== */
    function setActiveNav(id){
      ['books','cart','account','payment'].forEach(k=>{
        const el = document.getElementById('nav-'+k);
        if(el) el.classList.toggle('active', k===id);
      });
    }
    function showPage(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      if(id==='books')   { document.getElementById('page-books').classList.add('active'); setActiveNav('books'); }
      if(id==='details') { document.getElementById('page-details').classList.add('active'); setActiveNav('books'); }
      if(id==='cart')    { document.getElementById('page-cart').classList.add('active'); setActiveNav('cart'); updateCartUI(); }
      if(id==='account') { document.getElementById('page-account').classList.add('active'); setActiveNav('account'); }
      if(id==='payment') { document.getElementById('page-payment').classList.add('active'); setActiveNav('payment'); updateCartUI(); }
      window.scrollTo({top:0,behavior:'smooth'});
    }

    /* ====== عرض شبكة الكتب ====== */
    function renderBooks(list=BOOKS){
      booksGrid.innerHTML='';
      list.forEach(b=>{
        const card=document.createElement('article');
        card.className='card';
        card.onclick=()=>openDetails(b.id);
        card.innerHTML=`
          <img class="thumb" loading="lazy" src="${b.image}" alt="${b.title}">
          <div class="meta">
            <h3 class="title">${b.title}</h3>
            <div class="price">${b.price} جنيه</div>
          </div>`;
        booksGrid.appendChild(card);
      });
    }
    function filterBooks(q){
      q=(q||'').trim();
      const list = !q ? BOOKS : BOOKS.filter(b=>b.title.includes(q));
      renderBooks(list);
    }

    /* ====== تفاصيل وتعليقات ====== */
    let currentBook=null;
    function commentsKey(){return 'comments_'+(currentBook?.id||'')}
    function openDetails(id){
      const b=BOOKS.find(x=>x.id===id);
      if(!b) return;
      currentBook=b;
      dImg.src=b.image;
      dTitle.textContent=b.title;
      dPrice.textContent=b.price;
      dDesc.textContent=b.desc;
      dBadge.textContent = (b.price>130?'الأكثر مبيعًا':'كتاب مختار');
      renderComments();
      showPage('details');
    }
    function goBack(){ showPage('books'); if(qInput.value) filterBooks(qInput.value); }
    function renderComments(){
      const items = LS.get(commentsKey(), ["مفيد وعملي، أعجبني العرض.","مختصر وواضح جدًا.","أنصح بقراءته 👌"]);
      reviewsList.innerHTML='';
      items.forEach(c=>{
        const d=document.createElement('div');
        d.className='item'; d.textContent=c;
        reviewsList.appendChild(d);
      });
    }
    function addComment(){
      const v=(commentInput.value||'').trim();
      if(!v) return;
      const items=LS.get(commentsKey(),[]);
      items.push(v); LS.set(commentsKey(),items);
      commentInput.value=''; renderComments();
    }

    /* ====== السلة ====== */
    function cartKey(){return 'cart_v1'}
    function getCart(){return LS.get(cartKey(),[])}
    function saveCart(c){LS.set(cartKey(),c); updateCartUI()}
    function addCurrentToCart(){
      if(!currentBook) return;
      const c=getCart();
      const i=c.findIndex(x=>x.id===currentBook.id);
      if(i>-1) c[i].qty+=1;
      else c.push({id:currentBook.id,title:currentBook.title,price:currentBook.price,image:currentBook.image,qty:1});
      saveCart(c);
    }
    function updateQty(id,delta){
      const c=getCart(); const i=c.findIndex(x=>x.id===id);
      if(i>-1){ c[i].qty+=delta; if(c[i].qty<=0) c.splice(i,1); saveCart(c); }
    }
    function removeItem(id){ saveCart(getCart().filter(x=>x.id!==id)); }
    function clearCart(){ saveCart([]); }
    function updateCartUI(){
      const c=getCart();
      const count=c.reduce((a,x)=>a+x.qty,0);
      cartCount.textContent=count;
      cartList.innerHTML='';
      let total=0;
      c.forEach(it=>{
        total+=it.price*it.qty;
        const row=document.createElement('div');
        row.className='cart-row';
        row.innerHTML=`
          <img class="cthumb" src="${it.image}" alt="${it.title}">
          <div>
            <div style="font-weight:900">${it.title}</div>
            <div class="muted">${it.price} ج × ${it.qty}</div>
          </div>
          <div class="qty">
            <button onclick="updateQty('${it.id}',-1)">−</button>
            <div>${it.qty}</div>
            <button onclick="updateQty('${it.id}',1)">+</button>
          </div>
          <button class="btn ghost" onclick="removeItem('${it.id}')">حذف</button>`;
        cartList.appendChild(row);
      });
      cartTotalEl.textContent=total;
      paySummary.innerHTML = c.length
        ? c.map(i=>`• ${i.title} — ${i.qty} × ${i.price} ج`).join('<br>') + `<div class="divider"></div><b>الإجمالي: ${total} جنيه</b>`
        : 'السلة فارغة.';
    }

    /* ====== الحساب (محلي للتجربة) ====== */
    const nameInput=document.getElementById('nameInput');
    const welcomeBox=document.getElementById('welcomeBox');
    const welcomeName=document.getElementById('welcomeName');
    const authBox=document.getElementById('authBox');
    function fakeLogin(){
      const n=(nameInput.value||'').trim(); if(!n) return;
      LS.set('user_name',n); renderAuth();
    }
    function logout(){ localStorage.removeItem('user_name'); renderAuth(); }
    function renderAuth(){
      const n=LS.get('user_name',null);
      if(n){ welcomeName.textContent=n; welcomeBox.classList.remove('hide'); authBox.classList.add('hide'); }
      else{ welcomeBox.classList.add('hide'); authBox.classList.remove('hide'); }
    }

    /* ====== دفع ====== */
    function confirmOrder(){
      const total=cartTotalEl.textContent;
      alert('تم استلام طلبك بقيمة '+total+' جنيه. يرجى التحويل عبر فودافون كاش ثم تأكيد العملية. شكراً لك!');
    }

    /* ====== تشغيل أولي ====== */
    renderBooks(BOOKS);
    renderAuth();
    updateCartUI();

    // تذكُّر آخر كلمة بحث مؤقتًا
    const lastQ=sessionStorage.getItem('last_q')||'';
    if(lastQ){ qInput.value=lastQ; filterBooks(lastQ); }
    qInput.addEventListener('change',()=>sessionStorage.setItem('last_q',qInput.value||''));
  </script>
</body>
</html>
